<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>éŸ©æ–‡å•è¯è®°å¿†æ¸¸æˆ</title>
<script src="https://cdn.jsdelivr.net/pyodide/v0.24.0/full/pyodide.js"></script>
<style>
  body {
    font-family: 'Arial', sans-serif;
    background: #ffffff;
    text-align: center;
    padding: 1em;
    color: #333;
    max-width: 1024px;
    margin: 0 auto;
  }
  h1 {
    margin-bottom: 0.5em;
    font-size: 2.5em;
  }
  #progress {
    font-size: 1.8em;
    margin-bottom: 1em;
  }
  #question {
    font-size: 2.8em;
    margin: 0.8em 0;
    min-height: 1.5em;
  }
  .option-btn {
    display: block;
    margin: 0.8em auto;
    font-size: 2.2em;
    padding: 0.8em 1.6em;
    width: 80%;
    max-width: 500px;
    cursor: pointer;
    border-radius: 15px;
    border: 3px solid #a3c293;
    background: #d7f3d3;
    transition: background 0.3s, color 0.3s;
  }
  .option-btn:hover {
    background: #b5e0a4;
  }
  #feedback {
    font-size: 2.2em;
    height: 2em;
    margin: 1em 0;
    font-weight: bold;
    min-height: 1.5em;
  }
  #score {
    font-size: 2em;
    margin-top: 1.2em;
  }
  #next-btn, #home-btn, #restart-btn {
    margin-top: 1.5em;
    font-size: 2em;
    padding: 0.8em 1.6em;
    cursor: pointer;
    border-radius: 15px;
    background: #6fa06f;
    color: white;
    border: none;
    display: none;
    margin: 0.8em;
    width: 80%;
    max-width: 400px;
  }
  #next-btn:hover, #home-btn:hover, #restart-btn:hover {
    background: #4a7d4a;
  }
  #image {
    max-width: 300px;
    margin: 1em auto;
    display: block;
  }
  .button-container {
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  @media (max-width: 768px) {
    h1 {
      font-size: 2em;
    }
    #progress {
      font-size: 1.5em;
    }
    #question {
      font-size: 2em;
    }
    .option-btn {
      font-size: 1.8em;
    }
    #feedback {
      font-size: 1.8em;
    }
    #next-btn, #home-btn, #restart-btn {
      font-size: 1.6em;
    }
  }
</style>
</head>
<body>

<h1>éŸ©æ–‡å•è¯è®°å¿†æ¸¸æˆ</h1>
<div id="progress">é¢˜ç›® 0 / 0</div>
<div id="question">åŠ è½½ä¸­...</div>
<img id="image" src="" alt="é¢˜ç›®å›¾ç‰‡" style="display:none;">
<div id="options"></div>
<div id="feedback"></div>
<div class="button-container">
  <button id="next-btn">æ¬¡ã¸ï¼ˆä¸‹ä¸€é¢˜ï¼‰</button>
  <button id="home-btn">å›é¦–é </button>
  <button id="restart-btn">é‡æ–°å¼€å§‹</button>
</div>
<div id="score"></div>

<script>
let pyodide = null;
let gameReady = false;

async function initPyodideAndGame() {
  pyodide = await loadPyodide();

  const pythonCode = `
import random

word_data = [
    ("ã«ã‚…ã†ã«ã‚…ã†(ç‰›å¥¶)", ["ìš°ìœ ", "ì£¼ìŠ¤", "ë¹µ"], 0, "1.jpg"),
    ("ã‚¸ãƒ¥ãƒ¼ã‚¹(æœæ±)", ["ì£¼ìŠ¤", "ìš°ìœ ", "ì‚¬íƒ•"], 0, "2.jpg"),
    ("ãŠã‹ã—(é¥¼å¹²)", ["ê³¼ì", "ì‚¬íƒ•", "ë¹µ"], 0, "3.jpg"),
    ("ãƒ‘ãƒ³(é¢åŒ…)", ["ë¹µ", "ê³¼ì", "ì•„ì´ìŠ¤í¬ë¦¼"], 0, "4.jpg"),
    ("ã‚­ãƒ£ãƒ³ãƒ‡ã‚£(ç³–æœ)", ["ì‚¬íƒ•", "ì•„ì´ìŠ¤í¬ë¦¼", "ì£¼ìŠ¤"], 0, "5.jpg"),
    ("ã‚¢ã‚¤ã‚¹ã‚¯ãƒªãƒ¼ãƒ (å†°æ·‡æ·‹)", ["ì•„ì´ìŠ¤í¬ë¦¼", "ì‚¬íƒ•", "ë¹µ"], 0, "6.jpg"),
    ("ã­ã“(çŒ«)", ["ê³ ì–‘ì´", "ê°•ì•„ì§€", "ê³°"], 0, "7.jpg"),
    ("ã“ã„ã¬(å°ç‹—)", ["ê°•ì•„ì§€", "í† ë¼", "ê³°"], 0, "8.jpg"),
    ("ã†ã•ã(å…”å­)", ["í† ë¼", "ê°•ì•„ì§€", "ê³ ì–‘ì´"], 0, "9.jpg"),
    ("ãã¾(ç†Š)", ["ê³°", "ê³ ì–‘ì´", "í† ë¼"], 0, "10.jpg"),
    ("ã›ã‚“ã›ã„(è€å¸ˆ)", ["ì„ ìƒë‹˜", "ì±…ìƒ", "ì˜ì"], 0, "11.jpg"),
    ("ã¤ããˆ(ä¹¦æ¡Œ)", ["ì±…ìƒ", "ì˜ì", "ì¹ íŒ"], 0, "12.jpg"),
    ("ã„ã™(æ¤…å­)", ["ì˜ì", "ì±…ìƒ", "ê³µì±…"], 0, "13.jpg"),
    ("ã“ãã°ã‚“(é»‘æ¿)", ["ì¹ íŒ", "ì‹œê³„", "ì±…"], 0, "14.jpg"),
    ("ã¨ã‘ã„(æ—¶é’Ÿ)", ["ì‹œê³„", "ì¹ íŒ", "ì§€ìš°ê°œ"], 0, "15.jpg"),
    ("ã‘ã—ã‚´ãƒ (æ©¡çš®æ“¦)", ["ì§€ìš°ê°œ", "ì—°í•„", "ì±…"], 0, "16.jpg"),
    ("ã»ã‚“(ä¹¦)", ["ì±…", "ê³µì±…", "ì—°í•„"], 0, "17.jpg"),
    ("ãƒãƒ¼ãƒˆ(ç¬”è®°æœ¬)", ["ê³µì±…", "ì±…", "ì§€ìš°ê°œ"], 0, "18.jpg"),
    ("ãˆã‚“ã´ã¤(é“…ç¬”)", ["ì—°í•„", "ì§€ìš°ê°œ", "ê³µì±…"], 0, "19.jpg")
]


current_index = 0
score = 0
shuffled_data = []

def reset():
    global current_index, score, shuffled_data
    current_index = 0
    score = 0
    shuffled_data = []
    for q in word_data:
        options = q[1][:]
        correct_index = q[2]
        correct_answer = options[correct_index]
        random.shuffle(options)
        new_index = options.index(correct_answer)
        shuffled_data.append((q[0], options, new_index, q[3]))

def get_question():
    global current_index
    if current_index >= len(shuffled_data):
        return None
    q = shuffled_data[current_index]
    return {"question": q[0], "options": q[1], "image": q[3]}

def check_answer(selected_index):
    global current_index, score
    if current_index >= len(shuffled_data):
        return None
    correct = shuffled_data[current_index][2]
    is_correct = (selected_index == correct)
    if is_correct:
        score += 1
    current_index += 1
    return is_correct

def get_score():
    return score

def get_progress():
    return (min(current_index + 1, len(shuffled_data)), len(shuffled_data))

reset()
`;
  await pyodide.runPythonAsync(pythonCode);
  gameReady = true;
  loadNextQuestion();
}

function loadNextQuestion() {
  if (!gameReady) return;

  const question = pyodide.runPython("get_question()");
  if (!question) return showFinalScore();

  const progress = pyodide.runPython("get_progress()");
  document.getElementById("progress").innerText = `é¢˜ç›® ${progress[0]} / ${progress[1]}`;
  document.getElementById("question").innerText = question.get("question");

  const options = question.get("options").toJs();
  const imageSrc = question.get("image");

  const optionsDiv = document.getElementById("options");
  optionsDiv.innerHTML = "";
  document.getElementById("feedback").innerText = "";
  document.getElementById("next-btn").style.display = "none";
  document.getElementById("home-btn").style.display = "none";
  document.getElementById("restart-btn").style.display = "none";

  const img = document.getElementById("image");
  img.src = imageSrc;
  img.style.display = "block";

  options.forEach((opt, i) => {
    const btn = document.createElement("button");
    btn.className = "option-btn";
    btn.textContent = opt;
    btn.onclick = () => selectAnswer(i);
    optionsDiv.appendChild(btn);
  });
}

function selectAnswer(index) {
  if (!gameReady) return;

  const result = pyodide.runPython(`check_answer(${index})`);

  const feedbackEl = document.getElementById("feedback");
  const img = document.getElementById("image");

  if (result === true) {
    feedbackEl.style.color = "green";
    feedbackEl.innerText = "æ­£è§£ã§ã™ï¼ç­”å¯¹äº†ï¼ğŸ‰";
    img.src = "æ¯”ya.png";
  } else {
    const correctIndex = pyodide.runPython("shuffled_data[current_index - 1][2]");
    const correctOption = pyodide.runPython(`shuffled_data[current_index - 1][1][${correctIndex}]`);
    feedbackEl.style.color = "red";
    feedbackEl.innerText = `é–“é•ãˆã¾ã—ãŸï¼ç­”éŒ¯äº†ğŸ˜¢ æ­£è§£ã¯ï¼ˆæ­£ç¡®ç­”æ¡ˆæ˜¯ï¼‰ï¼š${correctOption}`;
    img.src = "åˆå.png";
  }

  document.querySelectorAll(".option-btn").forEach(btn => btn.disabled = true);
  document.getElementById("next-btn").style.display = "inline-block";

  const score = pyodide.runPython("get_score()");
  document.getElementById("score").innerText = `å½“å‰å¾—åˆ†ï¼š${score}`;
}

function showFinalScore() {
  const score = pyodide.runPython("get_score()");
  document.getElementById("question").innerText = "æ¸¸æˆç»“æŸï¼ğŸŠ";
  document.getElementById("options").innerHTML = "";
  document.getElementById("feedback").innerText = `ä½ çš„æ€»å¾—åˆ†æ˜¯ï¼š${score} / 19`;
  document.getElementById("next-btn").style.display = "none";
  document.getElementById("home-btn").style.display = "inline-block";
  document.getElementById("restart-btn").style.display = "inline-block";
}

document.getElementById("next-btn").addEventListener("click", loadNextQuestion);
document.getElementById("home-btn").addEventListener("click", () => {
  pyodide.runPython("reset()");
  loadNextQuestion();
});
document.getElementById("restart-btn").addEventListener("click", () => {
  pyodide.runPython("reset()");
  loadNextQuestion();
});

initPyodideAndGame();
</script>
</body>
</html>
